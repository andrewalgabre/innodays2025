<div class="analyzing-container">
  <!-- Header -->
  <header class="app-header">
    <button class="btn-icon-header" (click)="goHome()">
      <lucide-icon name="x"></lucide-icon>
    </button>
    <h1 class="app-title">Analyse</h1>
    <div class="placeholder"></div>
  </header>

  <!-- Main Content -->
  <main class="analyzing-main">
    <!-- Captured Image Preview -->
    <div class="image-preview" *ngIf="capturedImage">
      <img [src]="capturedImage" alt="Aufgenommenes Klauenbild">
    </div>

    <!-- Loading State -->
    <div class="status-card" *ngIf="isAnalyzing">
      <div class="loading-spinner">
        <lucide-icon name="loader-2" class="loading-icon animate-spin"></lucide-icon>
      </div>
      <h2>Bild wird analysiert</h2>
      <p>KI verarbeitet die Daten...</p>
    </div>

    <!-- Error State -->
    <div class="status-card error-card" *ngIf="error && !isAnalyzing">
      <div class="error-icon">
        <lucide-icon name="alert-circle"></lucide-icon>
      </div>
      <h2>Analyse fehlgeschlagen</h2>
      <p>{{ error }}</p>
      <button class="btn btn-primary" (click)="retryAnalysis()">
        <lucide-icon name="rotate-cw"></lucide-icon>
        Erneut versuchen
      </button>
    </div>

    <!-- Results Preview -->
    <div class="results-preview" *ngIf="analysisResult && !isAnalyzing && !error">
      <div class="result-icon success" *ngIf="analysisResult.diagnosis === 'gesund'">
        <lucide-icon name="check-circle-2"></lucide-icon>
      </div>
      <div class="result-icon warning" *ngIf="analysisResult.diagnosis !== 'gesund'">
        <lucide-icon name="alert-triangle"></lucide-icon>
      </div>

      <h2>Analyse abgeschlossen</h2>

      <!-- Summary Text -->
      <p class="summary-text" *ngIf="analysisResult.summary">
        {{ analysisResult.summary }}
      </p>

      <div class="result-summary">
        <div class="result-item">
          <span class="label">Diagnose</span>
          <span class="value diagnosis">{{ analysisResult.diagnosis | titlecase }}</span>
        </div>
        <div class="result-item">
          <span class="label">Konfidenz</span>
          <span class="value">{{ (analysisResult.confidence * 100).toFixed(0) }}%</span>
        </div>
        <div class="result-item">
          <span class="label">Schweregrad</span>
          <span class="value" [class]="'severity-' + analysisResult.severity">
            {{ analysisResult.severity | titlecase }}
          </span>
        </div>
      </div>

      <div class="recommendations" *ngIf="analysisResult.recommendations.length > 0">
        <h3>Empfehlungen</h3>
        <ul>
          <li *ngFor="let rec of analysisResult.recommendations">{{ rec }}</li>
        </ul>
      </div>

      <div class="alert-box" *ngIf="analysisResult.requiresVeterinaryAttention">
        <lucide-icon name="alert-circle"></lucide-icon>
        <span>Tierärztliche Behandlung empfohlen</span>
      </div>

      <button class="btn btn-primary" (click)="goToResults()">
        Vollständigen Bericht anzeigen
        <lucide-icon name="arrow-right"></lucide-icon>
      </button>
    </div>
  </main>
</div>
